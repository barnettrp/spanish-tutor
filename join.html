<script>
  document.getElementById("join").addEventListener("click", async () => {
    const name = document.getElementById("name").value.trim();
    const code = document.getElementById("code").value.trim();
    const msg  = document.getElementById("msg");

    if (!name || !code) {
      msg.textContent = "Please enter both your name and the party code.";
      return;
    }

    try {
      const r = await fetch("/api/join", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, code })
      });

      // Try to parse JSON, fall back to plain text
      let data = null, text = null;
      try {
        data = await r.json();
      } catch {
        text = await r.text();
      }

      if (!r.ok) {
        msg.textContent = (data && data.error) ? data.error
                        : (text || "Could not join.");
        return;
      }

      // If join successful, redirect to the conversation page
      location.href = "conversation.html";
    } catch (e) {
      msg.textContent = "Network error. Try again.";
    }
  });
</script>
